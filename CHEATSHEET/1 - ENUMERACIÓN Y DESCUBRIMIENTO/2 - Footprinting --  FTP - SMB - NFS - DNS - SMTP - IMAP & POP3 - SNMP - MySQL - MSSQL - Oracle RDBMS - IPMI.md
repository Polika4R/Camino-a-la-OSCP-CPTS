#FTP #SMB #NFS #DNS #SMTP #IMAP #POP3 #SNMP #MySQL #MSSQL #Oracle_RDBMS #IPMI

# FTP -p20,21

| Comando                                                                                          | Descripción                                                                                                                                                                             | Ejemplo                                                                                          |
| ------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ |
| ftp 1.2.3.4                                                                                      | **Iniciar una conexión FTP**                                                                                                                                                            | **[!]** Podemos probar con el usuario "anonymous".                                               |
| sesion_FTP> status                                                                               | Muestra **información varia del servicio FTP**                                                                                                                                          |                                                                                                  |
| sesion_FTP> debug                                                                                | Activa la depuración debug                                                                                                                                                              |                                                                                                  |
| sesion_FTP> trace                                                                                | Activa el **seguimiento de paquetes**                                                                                                                                                   |                                                                                                  |
| sesion_FTP> ls -R                                                                                | Lista directorios de forma recursiva del servicio FTP                                                                                                                                   |                                                                                                  |
| sesion_FTP>get <nombre_archivo>                                                                  | **Descarga** del servidor dicho archivo                                                                                                                                                 |                                                                                                  |
| wget -m --no-passive ftp://anonymous: anonymous@1.2.3.4                                          | **Descarga la totalidad** de las carpetas de un servicio FTP. Después con `"tree ."` podemos consultrar su estructura.                                                                  | wget -m --no-passive ftp://anonymous:anonymous @10.129.14.136                                    |
| sesion_FTP>put <nombre_archivo>                                                                  | **Sube un archivo** al servidor FTP                                                                                                                                                     | sesion_FTP>put shell.exe                                                                         |
| `cat /etc/vsftpd.conf`                                                                           | Para servidores vsFTPd, ese **archivo contiene los parámetros de configuración establecidos en el servidor.**                                                                           |                                                                                                  |
| `cat /etc/ftpusers` o<br>`cat /etc/vsftpd/ftpusers`                                              | Para servidores FTP (entre otros, vsFTPd), este documento contiene los usuarios bloqueados a utilizar dicho servicio                                                                    |                                                                                                  |
| `nc -nv 1.2.3.4 <port_a_atacar>` o <br>`nc -nv -p <num_port_origen> 1.2.3.4 <num_port_a_atacar>` | **Para detectar la versión del servicio FTP que a veces nmap obvia en el resumen.** FTP suele correr en el puerto 21. Puerto origen recomendado: 53 (DNS), que no suele estar filtrado. | `nc -nv 1.2.3.4 <port_a_atacar>` o <br>`nc -nv -p <num_port_origen> 1.2.3.4 <num_port_a_atacar>` |
# SMB -p445

| Comando                                                                                                                                           | Descripción                                                                                   | Ejemplo |
| ------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ------- |
| smbclient -N -L //1.2.3.4                                                                                                                         | **Numera recursos compartidos**                                                               |         |
| smbclient //1.2.3.4/<nombre_rescurso>                                                                                                             | **Acceder a un recurso** compartido concreto                                                  |         |
| smb: \> ls / cd / get                                                                                                                             | Dentro del recurso de SMB, puedo **listar directorios, acceder o descargar.**                 |         |
| rpcclient -U "" 1.2.3.4                                                                                                                           | Puedo realizar varias solicitudes para obtener información. Estas son:                        |         |
| rpc_client> `srvinfo`                                                                                                                             | Muestra información general del servidor.                                                     |         |
| rpc_client>`enumdomains`                                                                                                                          | Enumera todos los dominios visibles en la red.                                                |         |
| rpc_client>`querydominfo`                                                                                                                         | Muestra detalles del dominio, usuarios y controladores.                                       |         |
| rpc_client>`netshareenumall`                                                                                                                      | Lista todos los recursos compartidos disponibles (shares).                                    |         |
| rpc_client>`netsharegetinfo <nombre_recurso>`                                                                                                     | Muestra información detallada sobre un recurso compartido específico.                         |         |
| rpc_client>`enumdomusers`                                                                                                                         | Enumera todos los usuarios del dominio.                                                       |         |
| rpc_client>`queryuser <RID>`                                                                                                                      | Proporciona información detallada sobre un usuario (requiere RID). Ver comando `enumdomusers` |         |
| `smbmap -H 1.2.3.4`                                                                                                                               | **Numera recursos compartidos**                                                               |         |
| `crackmapexec smb 10.129.14.128 --shares -u '' -p '' `                                                                                            | **Numera recursos compartidos**                                                               |         |
| >git clone https://github.com/cddmp/enum4linux-ng.git<br>>cd enum4linux-ng<br>>pip3 install -r requirements.txt<br>>./enum4linux-ng.py 1.2.3.4 -A | Enumerar información en servidores SMB/Windows**                                              |         |
| `cat /etc/samba/smb.conf`                                                                                                                         | Para visualizar las parametros de configuración del servicio SMB.                             |         |

# NFS -p111,2049

| Comando                                               | Descripción                                                                                                                                                                    | Ejemplo                                                                                                     |
| ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------- |
| `sudo nmap <ip_víctima> -p111,2049 -sV -sC`           | Escanea los puertos 111 (rpcbind) y 2049 (NFS), detecta versiones de servicios y ejecuta scripts NSE básicos para obtener información general sobre el servicio NFS.           | `sudo nmap 10.129.14.128 -p111,2049 -sV -sC`                                                                |
| `sudo nmap --script nfs* <ip_víctima> -sV -p111,2049` | Escanea los puertos 111 y 2049, detecta versiones de servicios y ejecuta todos los scripts NSE relacionados con NFS, incluyendo la enumeración detallada de exportaciones NFS. | `sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049`                                                      |
| `showmount -e <ip_víctima>`                           | Únicamente muestra los recursos disponibles en una máquina víctima                                                                                                             | `showmount -e 10.129.14.128`                                                                                |
| >`sudo mount -t nfs <ip_victima>:/ . -o nolock`       | Proceso para mntar un recurso compartido NFS en local                                                                                                                          | >mkdir target-NFS<br>>sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock<br>>cd target-NFS<br>tree . |

# DNS -p53 tcp/udp

| Comando                                      | Descripción                                                                                                                                   | Ejemplo                                       |
| -------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| dig soa \<dominio>                           | Consulta el registro SOA (Start of Authority) del dominio, que indica cuál es el servidor DNS principal y contiene info clave de la zona DNS. | `dig soa hackthebox.com`                      |
| `dig ns <nombre_dominio> @<ip_servidor_DNS>` | Pregunta al servidor DNS en tal IP cuáles son los servidores de nombres para el dominio <nombre_dominio>                                      | `dig ns inlanefreight.htb @10.129.14.128`<br> |
| `dig any \<dominio> @<ip_servidor_DNS>`      | Consulta todos los registros DNS (`ANY`) del dominio directamente al servidor DNS que está en tal IP                                          | `dig any inlanefreight.htb @10.129.14.128`    |
| `dig axfr \<dominio> @<ip_servidor_DNS>`     | Intenta hacer una **transferencia de zona DNS** (`AXFR`) del dominio `inlanefreight.htb` desde el servidor DNS en `10.129.14.128`.            | `dig axfr inlanefreight.htb @10.129.14.128`   |
# SMTP -p25,587,465

| Comando                                                                                                         | Descripción                                                                                                      | Ejemplo                                                                                                                |
| --------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `telnet <ip_servidor> <puerto_25>`                                                                              | Interactuar con servicio SMTP                                                                                    | `telnet 10.129.14.128 25`<br>                                                                                          |
| `VRFY <nombre_usuario>`                                                                                         | Verifica que el usuario o dirección de correo electrónico existe en el servidor de correo.                       | VRFY root                                                                                                              |
| `EHLO <nombre_cliente>`                                                                                         | Se presenta al servidor y obtiene la lista de funciones SMTP disponibles (AUTH, STARTTLS, VRFY, etc.).           | `EHLO polika4r`                                                                                                        |
| `MAIL FROM: <cliente@dominio.com>`                                                                              | Inicia el envío de un mensaje desde la dirección especificada.                                                   | `MAIL FROM: <cry0l1t3@inlanefreight.htb>`                                                                              |
| `RCPT TO:<destinatario>`                                                                                        | Especifica el destinatario del mensaje. Se puede usar para verificar si el correo es aceptado.                   | `RCPT TO: <mrb3n@inlanefreight.htb>`                                                                                   |
| DATA                                                                                                            | Inicia la redacción del contenido del mensaje. Termina con una línea que contenga solo un punto (`.`)            |                                                                                                                        |
| QUIT                                                                                                            | Cierra la interacción con el srvicio SMTP                                                                        |                                                                                                                        |
| `sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v`                                                      | Escanea el puerto 25 buscando servidores SMTP con relay abierto (open relay).                                    | `sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v`                                                             |
| `nmap --script smtp-enum-users.nse -p 25,465,587 <host>`                                                        | Enumera usuarios válidos en el servidor SMTP usando script NSE.                                                  | `nmap --script smtp-enum-users.nse -p 25,465,587 10.129.14.128`                                                        |
| `smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/ wordlists /unix_users.txt -t <host> -w 120 -v` | Enumera usuarios SMTP usando el comando `VRFY` con una lista de usuarios. -w define el timeout, -v modo verbose. | `smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/wordlists/ unix_users.txt -t 10.129.3.215 -w 120 -v`\| |
| `msfconsole` + módulo `scanner/smtp/smtp_enum`<br>                                                              | Uso de Metasploit para enumerar usuarios SMTP en la víctima.                                                     |                                                                                                                        |

# IMAP & POP3 -p110,143,993,995

| Comando                                                       | Descripción                                                                                                                                                                                                                                                                                                                        | Ejemplo                                                   |
| ------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- |
| `nmap -p 110,995,143,993 --script ssl-cert <IP-del-servidor>` | Escanear puertos POP3/IMAP con análisis de certificado SSL/TLS                                                                                                                                                                                                                                                                     | `nmap -p 110,995,143,993 --script ssl-cert 10.129.14.128` |
| `curl -k 'imaps://<ip>' --user <usuario>:<contraseña>`        | Conectar al servidor IMAP sobre SSL con autenticación básica                                                                                                                                                                                                                                                                       | `curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd`    |
| `curl -k 'imaps://<ip>' --user <usuario>:<contraseña> -v`     | Igual que anterior, mostrando salida detallada (verbose)                                                                                                                                                                                                                                                                           | `curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v` |
| `openssl s_client -connect <ip>:pop3s`                        | Conectar manualmente al servicio POP3 seguro (puerto 995). Puedo: - Escribir comandos IMAP directamente <br>- Ver detalles del **certificado TLS** del servidor.<br>- Ver si el canal cifrado está funcionando correctamente.<br>- Ver errores o advertencias en la negociación SSL/TLS. -  <br>- Muestra acciones puedo realizar. | `openssl s_client -connect 10.129.14.128:pop3s`.<br><br>  |
| `openssl s_client -connect <ip>:imaps`                        | Conectar manualmente al servicio IMAP seguro (puerto 993). Puedo: - Escribir comandos IMAP directamente <br>- Ver detalles del **certificado TLS** del servidor.<br>- Ver si el canal cifrado está funcionando correctamente.<br>- Ver errores o advertencias en la negociación SSL/TLS. -  <br>- Muestra acciones puedo realizar. | `openssl s_client -connect 10.129.14.128:imaps`           |

# SNMP -p161,162udp 

| Comando                                                                                                    | Descripción                                                                                                                                                                                                                           | Ejemplo                                                                                                                                         |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `snmpwalk -v2c -c public <ip_victima>                                                                      | Herramienta para consultar recursivamente los OID de un dispositivo SNMP.<br>- Permite obtener toda la información disponible que el dispositivo expone vía SNMP.<br>- Muy útil para explorar y entender qué datos se pueden obtener. | `snmpwalk -v2c -c public 10.129.14.128`.<br><br>Esta salida es muy útil filtrarla con un:<br><br>\| grep "@"<br>\| grep ".sh"<br>\| grep "HTB{" |
| >`sudo apt install onesixtyone`<br>>`onesixtyone -c /opt/useful/secli sts/Discovery/SNMP /snmp.txt 1.2.3.4 | Para descubrir y forzar nombres de _community strings_ (cadenas de comunidad).<br><br>- La búsqueda puede ser lenta, ya que puede haber muchas combinaciones y nombres diferentes.                                                    |                                                                                                                                                 |
| >`sudo apt install braa`<br>>`braa public@<ip_victima>:<community_string>`                                 | Escanea servicios SNMP y enumerar información específica.<br>    <br>- Se usa para consultar OID individuales con una cadena de comunidad conocida.                                                                                   | >`sudo apt install braa`<br>>`braa public@10.129.14.128:.1.3.6.*`                                                                               |

# MySQL -p3306

| Comando                                                     | Descripción                                                                                                                                                                          | Ejemplo                                                  |
| ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------- |
| `sudo nmap 1.2.3.4 -sV -sC -p3306 --script mysql*`          | Escaneo de nmap para descubrir todos los scripts de nmap relacionados con MySQL para obtener detalles específicos del servicio, como usuarios, configuración, vulnerabilidades, etc. | `sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*` |
| `mysql -u <usuario> -h 1.2.3.4`                             | Conectar al servidor MySQL remoto con el usuario especificado, sin pedir contraseña (útil si no tiene o para autenticación sin contraseña).                                          | `mysql -u root -h 10.129.14.132`                         |
| `mysql -u <usuario> -p<contraseña> -h 1.2.3.4`              | Conectar al servidor MySQL remoto usando usuario y contraseña (sin espacio entre `-p` y la contraseña).                                                                              | `mysql -u root -pP4SSw0rd -h 10.129.14.128`              |
| `MySQL> show databases;`                                    | Muestra todas las bases de datos disponibles en el servidor MySQL.                                                                                                                   | `show databases;`                                        |
| `MySQL> use <database>;`                                    | Selecciona la base de datos sobre la que se quieren ejecutar las consultas.                                                                                                          | `use wordpress;`                                         |
| `MySQL> show tables;`                                       | Muestra todas las tablas existentes en la base de datos seleccionada.                                                                                                                | `show tables;`                                           |
| `MySQL> show columns from <table>;`                         | Muestra todas las columnas (campos) de la tabla especificada, junto con sus tipos y atributos.                                                                                       | `show columns from users;`                               |
| `MySQL> select * from <table>;`                             | Muestra todos los registros (filas) y columnas de la tabla indicada.                                                                                                                 | `select * from users;`                                   |
| `MySQL> select * from <table> where <column> = "<string>";` | Busca y muestra las filas de la tabla que cumplen la condición indicada (columna igual a un valor específico).                                                                       | `select * from users where username = "admin";`          |

# MSSQL -p1433

| Comando                                                                                                                                                                                                                                                                                                 | Descripción                                                                                                                  | Ejemplo                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `sudo nmap --script ms-sql-info,ms-sql-empty -password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm- info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa, mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 1.2.3.4` | Escanea un servidor MSSQL en 1433, prueba credenciales vacías y ejecuta scripts de información y explotación.                | sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config, ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username =sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.129.201.248 |
| msfconsole<br>use scanner/mssql_ping<br>	set rhosts 1.2.3.4<br>	run                                                                                                                                                                                                                                     | Detecta y enumera instancias MSSQL, versión, nombre, datos del host y tipo de conexión soportada.<br><br>Preguntar a ChatGPT |                                                                                                                                                                                                                                                                                                             |
| python3 mssqlclient.py \<user>@1.2.3.4 -windows-auth<br>                                                                                                                                                                                                                                                | Conectar con credenciales conocidas al servidor MMSQL                                                                        | python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth.<br>Con un ***select name from sys.databases*** se listan las bases de datos existentes.                                                                                                                                                  |

# Oracle RDBMS -p1521

| Comando                                                         | Descripción                                                                                                                                 | Ejemplo                                                                |     |
| --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- | --- |
| `sudo nmap -p1521 -sV 1.2.3.4 --open --script oracle-sid-brute` | Para **descubrir el SID (System Identifier)** de una base de datos Oracle                                                                   | `sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute` |     |
| `./odat.py all -s 1.2.3.4`                                      | Lanza todas las pruebas posibles contra un servidor Oracle (enumeración de SID, fuerza bruta de credenciales, ejecución de comandos, etc.). | `./odat.py all -s 10.129.204.235`                                      |     |
| `sqlplus \<usuario>/<contraseña> @1.2.3.4/\<SIDs>`              | Para conectarse a una base de datos de Oracle.                                                                                              | `sqlplus scott/tiger@10.129.204.235/XE`                                |     |
| `SQL> select table_name from all_tables;`                       | Muestra una lista de todas las tablas accesibles por el usuario actual.                                                                     | `SQL> select table_name from all_tables;`                              |     |
| `SQL>select * from user_role_privs;`                            | Lista los roles y privilegios asignados al usuario conectado.                                                                               | `SQL>select * from user_role_privs;`                                   |     |
| `sqlplus \<usuario>/<contraseña> @1.2.3.4/\<SIDs> as sysdba`    | Se conecta a Oracle como el usuario especificado **con privilegios de administrador (`SYSDBA`)**.                                           | `sqlplus scott/tiger@10.129.204.235/XE as sysdba`                      |     |
| `SQL> select name, password from sys.user$;`                    | Muestra los **hashes de contraseñas** de todos los usuarios de la base de datos (requiere privilegios elevados como `SYSDBA`).              |                                                                        |     |
# IPMI -p623udp

| Comando                                                                                                                | Descripción                                                                                                                                   | Ejemplo                                                             |
| ---------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `sudo nmap -sU --script ipmi-version -p 623 1.2.3.4`                                                                   | Escaneo de nmap para averiguar versión IPMI.<br>Ojo: versión 2 IPMI hacer escaneo con msfconsole: use auxiliary/scanner /ipmi/ipmi_dumphashes | `sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local` |
| msfconsole<br>msf6 > use auxiliary/ scanner/ipmi/ipmi_version<br>msf6> show options<br>msf6> set RHOSTS 1.2.3.4<br>run | Escaneo de nmap para averiguar versión IPMI.<br>Ojo: versión 2 IPMI hacer escaneo con msfconsole: use auxiliary/scanner /ipmi/ipmi_dumphashes |                                                                     |
| msfconsole<br>msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes <br>msf6 > set rhosts 1.2.3.4<br>msf6 > show options   | Escaneo avanzado con msfconsole y ipmi_dumphases para obtener hashes de contraseñas.                                                          |                                                                     |
| hashcat -m 7300 -a 0 hash.txt /usr/share/seclists/Passwords/Leaked-Databases/rockyou-75.txt                            | Crackear un HASH IPMI. El formato del archivo hash.txt tiene que ser del tipo  "hash1:hash2"                                                  |                                                                     |

